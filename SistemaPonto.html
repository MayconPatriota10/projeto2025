<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Ponto Eletrônico</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="SistemaPonto.css">
</head>
<body>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <h3 class="text-center">Sistema de Ponto Eletrônico</h3>
      <form id="pontoForm">
        <div class="form-group">
          <label for="cpf">CPF do Aluno:</label>
          <input type="text" class="form-control" id="cpf" placeholder="Digite o CPF" required maxlength="14" oninput="mascaraCPF(this)">
        </div>
        
        <div class="form-group">
          <label>Selecione a Ação:</label>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="acao" id="entrada" value="entrada" required>
            <label class="form-check-label" for="entrada">
              Entrada
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="acao" id="saida" value="saida">
            <label class="form-check-label" for="saida">
              Saída
            </label>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary w-100">Registrar Ponto</button>
      </form>
      <div id="mensagem" class="mt-3"></div>
      
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.getElementById('pontoForm').addEventListener('submit', function(event) {
    event.preventDefault();

    const cpf = document.getElementById('cpf').value;
    const acao = document.querySelector('input[name="acao"]:checked');
    
    // Verificar se o CPF está cadastrado no localStorage
    let alunos = JSON.parse(localStorage.getItem('alunos')) || [];
    const aluno = alunos.find(aluno => aluno.cpf === cpf);
    
    if (!aluno) {
      document.getElementById('mensagem').innerHTML = 
        `<div class="alert alert-danger">CPF não cadastrado. Tente novamente.</div>`;
      return;
    }

    if (!acao) {
      document.getElementById('mensagem').innerHTML = 
        `<div class="alert alert-danger">Selecione uma ação (Entrada ou Saída).</div>`;
      return;
    }

    // Obter a data atual (formato YYYY-MM-DD)
    const hoje = new Date().toISOString().split('T')[0];
    
    // Carregar registros de ponto do localStorage
    let pontos = JSON.parse(localStorage.getItem('pontos')) || [];
    
    // Filtrar registros do CPF para o dia atual
    const registrosHoje = pontos.filter(p => p.cpf === cpf && p.data === hoje);
    
    // Verificar se já existe entrada ou saída para hoje
    const temEntrada = registrosHoje.some(p => p.acao === 'entrada');
    const temSaida = registrosHoje.some(p => p.acao === 'saida');
    
    if (acao.value === 'entrada') {
      if (temEntrada) {
        document.getElementById('mensagem').innerHTML = 
          `<div class="alert alert-danger">Entrada já registrada para hoje.</div>`;
        return;
      }
      // Registrar entrada
      pontos.push({ cpf, acao: 'entrada', data: hoje, timestamp: new Date().toISOString() });
      localStorage.setItem('pontos', JSON.stringify(pontos));
      document.getElementById('mensagem').innerHTML = 
        `<div class="alert alert-success">Entrada registrada com sucesso para o aluno: ${aluno.nome}</div>`;
    } else if (acao.value === 'saida') {
      if (!temEntrada) {
        document.getElementById('mensagem').innerHTML = 
          `<div class="alert alert-danger">Não é possível registrar saída sem uma entrada registrada hoje.</div>`;
        return;
      }
      if (temSaida) {
        document.getElementById('mensagem').innerHTML = 
          `<div class="alert alert-danger">Saída já registrada para hoje.</div>`;
        return;
      }
      // Registrar saída
      pontos.push({ cpf, acao: 'saida', data: hoje, timestamp: new Date().toISOString() });
      localStorage.setItem('pontos', JSON.stringify(pontos));
      document.getElementById('mensagem').innerHTML = 
        `<div class="alert alert-success">Saída registrada com sucesso para o aluno: ${aluno.nome}</div>`;
    }

    // Limpar o formulário
    document.getElementById('pontoForm').reset();
  });

  function mascaraCPF(campo) {
    let cpf = campo.value.replace(/\D/g, ''); // Remove qualquer caractere que não seja número
    if (cpf.length <= 11) {
      campo.value = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    }
  }
</script>
</body>
</html>